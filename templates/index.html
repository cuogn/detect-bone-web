<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chẩn đoán thoái hóa khớp gối</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              mono: ["JetBrains Mono", "monospace"],
            },
            colors: {
              medical: {
                900: "#0f172a", // Deep dark
                800: "#1e293b", // Panel bg
                700: "#334155", // Border
                500: "#06b6d4", // Primary Cyan
                400: "#22d3ee", // Light Cyan
              },
            },
            backgroundImage: {
              "grid-pattern":
                "linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)",
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/sample.css') }}"
    />
    <!-- Chart.js cho biểu đồ xác suất KL -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Logic giao diện & phân tích -->
  </head>
  <body class="antialiased min-h-screen flex flex-col">
    <!-- Background Elements -->
    <div class="fixed inset-0 z-[-1]">
      <div class="absolute inset-0 bg-medical-900"></div>
      <div
        class="absolute inset-0 bg-grid-pattern bg-grid opacity-[0.15]"
      ></div>
      <!-- Abstract Glow -->
      <div
        class="absolute top-0 right-0 w-[500px] h-[500px] bg-medical-500 rounded-full blur-[120px] opacity-10"
      ></div>
      <div
        class="absolute bottom-0 left-0 w-[400px] h-[400px] bg-purple-600 rounded-full blur-[120px] opacity-10"
      ></div>
    </div>

    <!-- Header / Navbar -->
    <header class="sticky top-0 z-50 glass-panel border-b border-white/5">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between"
      >
        <div
          class="flex items-center gap-3 cursor-pointer"
          onclick="switchTab('home')"
        >
          <div
            class="w-10 h-10 rounded bg-gradient-to-br from-medical-400 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20"
          >
            <img
              src="{{ url_for('static', filename='img/bones-joint-svgrepo-com.svg') }}"
              alt="Logo"
              class="w-8 h-8"
            />
          </div>
          <div>
            <h1
              class="font-bold text-lg tracking-tight text-white leading-none"
            >
              XuongKhop<span class="text-medical-400">.AI</span>
            </h1>
            <p
              class="text-[11px] text-slate-400 uppercase tracking-widest font-mono mt-1"
            >
              AI hỗ trợ phân loại thoái hóa khớp gối
            </p>
          </div>
        </div>

        <nav
          class="hidden md:flex space-x-1 bg-slate-800/50 p-1 rounded-lg border border-white/5 items-center"
        >
          <button
            onclick="switchTab('home')"
            id="nav-home"
            class="px-4 py-1.5 text-sm font-medium rounded-md text-white bg-white/10 shadow transition-all nav-pill"
          >
            Tổng quan
          </button>
          <button
            onclick="switchTab('home-intro')"
            id="nav-intro"
            class="px-4 py-1.5 text-sm font-medium rounded-md text-slate-400 hover:text-white transition-all nav-pill"
          >
            Giới thiệu
          </button>
          <button
            onclick="switchTab('home-algo')"
            id="nav-algo"
            class="px-4 py-1.5 text-sm font-medium rounded-md text-slate-400 hover:text-white transition-all nav-pill"
          >
            Tìm hiểu thuật toán
          </button>

          <button
            onclick="switchTab('home-kl')"
            id="nav-kl"
            class="px-4 py-1.5 text-sm font-medium rounded-md text-slate-400 hover:text-white transition-all nav-pill"
          >
            Thang KL
          </button>
          <button
            onclick="switchTab('tool')"
            id="nav-tool"
            class="px-4 py-1.5 text-sm font-medium rounded-md text-slate-400 hover:text-white transition-all nav-pill"
          >
            Công cụ phát hiện
          </button>
          <div class="pl-3 text-xs text-slate-400 flex items-center gap-2">
            <label for="theme-select" class="sr-only">Chọn theme</label>
            <select
              id="theme-select"
              class="bg-slate-900/70 border border-white/10 rounded-md px-2 py-1 text-slate-200 text-xs focus:outline-none focus:ring-1 focus:ring-medical-400"
            >
              <option value="blue">Blue</option>
              <option value="cyan">Cyan</option>
              <option value="teal">Teal</option>
              <option value="emerald">Emerald</option>
              <option value="green">Green</option>
              <option value="lime">Lime</option>
              <option value="amber">Amber</option>
              <option value="orange">Orange</option>
              <option value="red">Red</option>
              <option value="pink">Pink</option>
              <option value="purple">Purple</option>
              <option value="indigo">Indigo</option>
              <option value="white">White</option>
            </select>
          </div>
        </nav>
      </div>
    </header>

    <!-- Main View -->
    <main class="flex-grow relative">
      <!-- === VIEW: HOME === -->
      <section id="view-home" class="fade-enter">
        <!-- Hero Section -->
        <div class="relative pt-16 pb-20 lg:pt-24 lg:pb-28">
          <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative text-center"
            data-animate="fade"
          >
            <h1
              class="text-5xl md:text-7xl font-bold tracking-tight text-white mb-6"
              data-animate="fade-up"
            >
              Chẩn đoán Thoái hóa khớp gối<br />
              <span
                class="text-transparent bg-clip-text bg-gradient-to-r from-medical-400 to-blue-500"
                >Chính xác & Tức thì</span
              >
            </h1>
            <p
              class="mt-4 max-w-2xl mx-auto text-lg text-slate-400"
              data-animate="fade-up"
            >
              Nền tảng hỗ trợ bác sĩ phân loại KL-Score tự động từ ảnh X-quang.
              Tối ưu quy trình chẩn đoán hình ảnh với Deep Learning.
            </p>

            <div class="mt-10 flex justify-center gap-4" data-animate="fade-up">
              <button
                onclick="switchTab('tool')"
                class="group relative px-8 py-3 bg-medical-500 hover:bg-medical-400 text-white font-semibold rounded-lg shadow-[0_0_20px_rgba(6,182,212,0.3)] transition-all overflow-hidden btn-hover-lift"
              >
                <div
                  class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite]"
                ></div>
                <span>Truy cập Workstation</span>
              </button>
              <button
                onclick="switchTab('home-algo')"
                id="nav-algo"
                class="px-8 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 font-semibold rounded-lg border border-white/5 transition-colors btn-hover-lift"
              >
                Tìm hiểu thuật toán
              </button>
            </div>

            <!-- Decorative Image Grid -->
            <div class="mt-20 relative">
              <div
                class="absolute inset-0 bg-gradient-to-t from-[#0b1120] via-transparent to-transparent z-10"
              ></div>
              <div
                class="grid grid-cols-3 md:grid-cols-5 gap-4 opacity-80 grayscale hover:grayscale-0 transition-all duration-700"
              >
                <!-- Simulated X-Ray Thumbnails -->
                <div
                  class="aspect-[3/4] bg-slate-800 rounded-lg overflow-hidden border border-white/5"
                >
                  <img
                    src="https://images.unsplash.com/photo-1530497610245-94d3c16cda28?auto=format&fit=crop&q=80&w=300"
                    class="w-full h-full object-cover mix-blend-luminosity"
                    alt="Bone"
                  />
                </div>
                <div
                  class="aspect-[3/4] bg-slate-800 rounded-lg overflow-hidden border border-white/5 mt-8"
                >
                  <img
                    src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?auto=format&fit=crop&q=80&w=300"
                    class="w-full h-full object-cover mix-blend-luminosity"
                    alt="Medical"
                  />
                </div>
                <div
                  class="aspect-[3/4] bg-slate-800 rounded-lg overflow-hidden border border-white/5"
                >
                  <img
                    src="https://images.unsplash.com/photo-1516549655169-df83a0774514?auto=format&fit=crop&q=80&w=300"
                    class="w-full h-full object-cover mix-blend-luminosity"
                    alt="Doctor"
                  />
                </div>
                <div
                  class="aspect-[3/4] bg-slate-800 rounded-lg overflow-hidden border border-white/5 mt-8 hidden md:block"
                >
                  <img
                    src="https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&q=80&w=300"
                    class="w-full h-full object-cover mix-blend-luminosity"
                    alt="Lab"
                  />
                </div>
                <div
                  class="aspect-[3/4] bg-slate-800 rounded-lg overflow-hidden border border-white/5 hidden md:block"
                >
                  <img
                    src="https://plus.unsplash.com/premium_photo-1726768840957-5a9ebaa1e33a?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D?auto=format&fit=crop&q=80&w=300"
                    class="w-full h-full object-cover mix-blend-luminosity"
                    alt="Analysis"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Giới thiệu đề tài (merge từ gioithieu.html) -->
        <div
          id="section-intro"
          class="py-16 bg-slate-950/40 border-b border-white/5"
          data-animate="fade-up"
        >
          <div class="max-w-5xl mx-auto px-4 space-y-10">
            <div class="flex flex-col md:flex-row md:items-start gap-8">
              <div class="flex-1">
                <h2
                  class="text-2xl md:text-3xl font-bold text-white mb-4 flex items-center"
                >
                  <span class="w-1 h-8 bg-medical-500 mr-3 rounded-full"></span>
                  Giới thiệu đề tài
                </h2>
                <p class="text-slate-300 leading-relaxed">
                  Bệnh lý xương khớp, đặc biệt là thoái hóa khớp gối, đang ngày
                  càng phổ biến ở mọi lứa tuổi. Việc chẩn đoán sớm giữ vai trò
                  quan trọng giúp kiểm soát tiến triển và nâng cao chất lượng
                  sống. Dự án này hướng đến việc ứng dụng trí tuệ nhân tạo trong
                  phân tích ảnh X-quang khớp gối, hỗ trợ bác sĩ và nhà nghiên
                  cứu đánh giá mức độ thoái hóa một cách nhanh chóng và khách
                  quan.
                </p>
              </div>
              <div
                class="flex-1 glass-panel rounded-xl p-4 border border-white/10"
              >
                <h3 class="text-lg font-semibold text-white mb-3">
                  Tổng quan xương khớp
                </h3>
                <div class="space-y-5 text-sm text-slate-300">
                  <div>
                    <h4 class="font-medium text-slate-100 mb-1">
                      Ảnh hưởng đến chất lượng sống
                    </h4>
                    <p>
                      Thoái hóa khớp gối khiến sụn khớp bị bào mòn, làm giảm khả
                      năng vận động và gây đau nhức kéo dài, đặc biệt khi đứng
                      lâu, leo cầu thang hay thay đổi thời tiết. Nếu không phát
                      hiện sớm và điều trị đúng cách, cơn đau ngày càng nặng,
                      ảnh hưởng lớn đến công việc và sinh hoạt.
                    </p>
                  </div>
                  <div>
                    <h4 class="font-medium text-slate-100 mb-1">
                      Nhóm nguy cơ cao
                    </h4>
                    <p>
                      Người lớn tuổi, người thừa cân, lao động nặng, vận động
                      viên cường độ cao và những người từng chấn thương vùng gối
                      là các nhóm có nguy cơ thoái hóa khớp gối sớm hơn.
                    </p>
                  </div>
                  <div>
                    <h4 class="font-medium text-slate-100 mb-1">
                      Vì sao cần phát hiện sớm
                    </h4>
                    <p>
                      Phát hiện sớm giúp theo dõi tiến triển bệnh rõ ràng, lựa
                      chọn phác đồ điều trị phù hợp, kiểm soát đau, cải thiện
                      vận động và hạn chế biến dạng khớp hay tàn phế về sau.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tìm hiểu thuật toán -->
        <div
          id="section-algo"
          class="py-16 bg-slate-950/30 border-b border-white/5"
          data-animate="fade-up"
        >
          <div class="max-w-5xl mx-auto px-4 space-y-8">
            <div class="flex items-center gap-3">
              <span class="w-1 h-8 bg-medical-500 rounded-full"></span>
              <h2 class="text-2xl md:text-3xl font-bold text-white">
                Tìm hiểu thuật toán
              </h2>
            </div>

            <div
              class="glass-panel p-0 overflow-hidden rounded-2xl border border-white/10 shadow-lg"
              data-animate="zoom"
            >
              <div class="relative aspect-[16/9] md:aspect-[16/5] bg-slate-900">
                <img
                  src="https://images.unsplash.com/photo-1715531786629-bd8b2dd87066?q=30&w=1600&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D?auto=format&fit=crop&w=1600&q=80"
                  alt="X-ray analysis"
                  class="w-full h-full object-cover opacity-95"
                />
                <div
                  class="absolute inset-0 bg-gradient-to-r from-[#0b1120cc] via-[#0b112080] to-transparent"
                ></div>
                <div class="absolute left-6 bottom-6 text-white space-y-1">
                  <p class="text-xs uppercase tracking-[0.2em] text-slate-100">
                    Deep Learning Imaging
                  </p>
                  <h3 class="text-xl font-semibold text-slate-100">
                    Pipeline CNN cho X-quang
                  </h3>
                  <p class="text-sm text-slate-100">
                    Tiền xử lý → Trích xuất đặc trưng → Phân loại KL0–KL4
                  </p>
                </div>
              </div>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
              <div class="md:col-span-2 space-y-4">
                <div class="glass-panel p-5 rounded-xl border border-white/10">
                  <h3 class="text-lg font-semibold text-medical-400">
                    Convolutional Neural Network (CNN)
                  </h3>
                  <p class="text-slate-300 text-sm leading-relaxed">
                    CNN được chọn vì chuyên xử lý dữ liệu ảnh, tự động học đặc
                    trưng (cạnh, đường cong, hình khối) qua các lớp tích chập.
                    So với mô hình truyền thống, CNN tận dụng cấu trúc không
                    gian của ảnh, giảm tham số và thường đạt độ chính xác cao
                    trong các bài toán X-quang/MRI.
                  </p>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                  <div
                    class="glass-panel p-4 rounded-xl border border-white/10"
                  >
                    <h4 class="text-sm font-semibold text-white">
                      Lớp Convolution
                    </h4>
                    <p class="text-slate-300 text-sm mt-1 leading-relaxed">
                      Các lớp đầu học cạnh đơn giản; lớp sâu hơn học cấu trúc
                      phức tạp như hình dạng xương, vùng tổn thương. Chuỗi nhiều
                      lớp chập giúp đặc trưng ngày càng trừu tượng và giàu thông
                      tin.
                    </p>
                  </div>
                  <div
                    class="glass-panel p-4 rounded-xl border border-white/10"
                  >
                    <h4 class="text-sm font-semibold text-white">
                      Lớp Pooling
                    </h4>
                    <p class="text-slate-300 text-sm mt-1 leading-relaxed">
                      Max pooling giảm kích thước feature map, giảm tham số và
                      chi phí tính toán, đồng thời giúp mô hình bền vững trước
                      dịch chuyển/nhiễu nhỏ.
                    </p>
                  </div>
                </div>

                <div class="glass-panel p-4 rounded-xl border border-white/10">
                  <h4 class="text-sm font-semibold text-white">
                    Lớp Fully Connected & Softmax
                  </h4>
                  <p class="text-slate-300 text-sm mt-1 leading-relaxed">
                    Sau khi flatten, các lớp fully connected ánh xạ đặc trưng
                    sang 5 mức KL. Lớp cuối dùng Softmax tạo phân bố xác suất và
                    chọn mức KL có xác suất cao nhất.
                  </p>
                </div>
              </div>

              <div class="space-y-4">
                <div
                  class="glass-panel p-4 rounded-xl border border-medical-500/30 bg-medical-500/5"
                >
                  <h4 class="text-sm font-semibold text-medical-400">
                    Thử nghiệm kiến trúc phổ biến
                  </h4>
                  <p class="text-slate-200 text-sm mt-1 leading-relaxed">
                    ResNet, VGG16 (pretrained ImageNet) có thể fine-tune trên dữ
                    liệu X-quang để so sánh với CNN tự xây dựng về độ chính xác,
                    tốc độ hội tụ và thời gian suy luận.
                  </p>
                </div>
                <div class="glass-panel p-4 rounded-xl border border-white/10">
                  <h4 class="text-sm font-semibold text-white">
                    Mục tiêu phân loại
                  </h4>
                  <ul
                    class="list-disc list-inside text-slate-300 text-sm space-y-1"
                  >
                    <li>5 lớp đầu ra tương ứng KL0–KL4.</li>
                    <li>Tối ưu cho ảnh X-quang khớp gối.</li>
                    <li>Cân bằng giữa độ chính xác và tốc độ suy luận.</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Mô tả chi tiết thang KL (merge từ phan-loai-kl.html) -->
        <div
          id="section-kl"
          class="py-16 bg-slate-900/40"
          data-animate="fade-up"
        >
          <div class="max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-between mb-8 gap-4">
              <h2 class="text-2xl md:text-3xl font-bold text-white flex-1">
                Thang phân loại Kellgren–Lawrence
              </h2>
              <div class="hidden md:flex gap-3 text-xs text-slate-400">
                <span
                  class="px-3 py-1 rounded-full border border-white/10 bg-slate-900/60"
                  >KL0–KL4</span
                >
                <span
                  class="px-3 py-1 rounded-full border border-white/10 bg-slate-900/60"
                  >X-quang khớp gối</span
                >
              </div>
            </div>

            <div class="space-y-6">
              <!-- KL0 -->
              <article
                class="glass-panel rounded-xl p-5 md:p-6 border border-white/10 flex flex-col md:flex-row gap-5"
              >
                <div class="w-full md:w-56 shrink-0">
                  <img
                    src="https://nhatnhat.com/pic/New/images/2018/xknn/1(1).jpg"
                    alt="KL0 bình thường"
                    class="w-full h-40 md:h-48 object-cover rounded-lg border border-white/10"
                  />
                </div>
                <div class="flex-1">
                  <h3 class="text-lg md:text-xl font-semibold text-green-400">
                    KL0 — Bình thường
                  </h3>
                  <p class="mt-2 text-sm text-slate-300 leading-relaxed">
                    Ở mức KL0, khớp gối hoàn toàn bình thường, các bề mặt xương
                    được bao phủ bởi lớp sụn trơn láng, khe khớp được bảo tồn
                    với khoảng cách đều và rõ. Không có dấu hiệu hình thành gai
                    xương, không xuất hiện xơ cứng dưới sụn hay biến dạng đầu
                    xương. Đây là trạng thái khỏe mạnh của khớp, cho phép vận
                    động linh hoạt mà không gây đau hay tiếng lạo xạo khi cử
                    động.
                  </p>
                </div>
              </article>

              <!-- KL1 -->
              <article
                class="glass-panel rounded-xl p-5 md:p-6 border border-white/10 flex flex-col md:flex-row gap-5"
              >
                <div class="flex-1">
                  <h3 class="text-lg md:text-xl font-semibold text-yellow-300">
                    KL1 — Nghi ngờ
                  </h3>
                  <p class="mt-2 text-sm text-slate-300 leading-relaxed">
                    Giai đoạn KL1 được đặc trưng bởi sự xuất hiện của các gai
                    xương rất nhỏ ở rìa khớp (mới hình thành), trong khi khe
                    khớp vẫn giữ nguyên chiều rộng bình thường. Lớp sụn khớp có
                    thể xuất hiện những thay đổi vi thể, nhưng chưa đủ để thể
                    hiện rõ trên X-quang. Bệnh nhân thường chưa có biểu hiện lâm
                    sàng cụ thể, đôi khi chỉ xuất hiện cảm giác đau âm ỉ, mỏi
                    nhẹ vùng gối khi vận động kéo dài hoặc thay đổi thời tiết.
                    Đây là giai đoạn sớm nhất của thoái hóa, cần được theo dõi
                    định kỳ.
                  </p>
                </div>
                <div class="w-full md:w-56 shrink-0">
                  <img
                    src="https://nhatnhat.com/pic/New/images/2018/xknn/3(1).jpg"
                    alt="KL1 nghi ngờ"
                    class="w-full h-40 md:h-48 object-cover rounded-lg border border-white/10"
                  />
                </div>
              </article>

              <!-- KL2 -->
              <article
                class="glass-panel rounded-xl p-5 md:p-6 border border-white/10 flex flex-col md:flex-row gap-5"
              >
                <div class="w-full md:w-56 shrink-0">
                  <img
                    src="https://nhatnhat.com/pic/New/images/2018/xknn/4.png"
                    alt="KL2 nhẹ"
                    class="w-full h-40 md:h-48 object-cover rounded-lg border border-white/10"
                  />
                </div>
                <div class="flex-1">
                  <h3 class="text-lg md:text-xl font-semibold text-orange-300">
                    KL2 — Nhẹ
                  </h3>
                  <p class="mt-2 text-sm text-slate-300 leading-relaxed">
                    Giai đoạn KL2 được xác định khi hình ảnh X-quang cho thấy
                    các gai xương rõ ràng ở rìa khớp, khe khớp hẹp nhẹ do sụn
                    khớp bắt đầu bị bào mòn không đồng đều. Có thể kèm xơ cứng
                    dưới sụn (subchondral sclerosis) và thay đổi mật độ xương
                    quanh vùng khớp. Bệnh nhân thường bắt đầu xuất hiện đau cơ
                    học khi vận động, cảm giác cứng khớp tạm thời sau nghỉ ngơi
                    và đôi khi nghe thấy tiếng lạo xạo trong khớp. Đây là giai
                    đoạn chuyển tiếp quan trọng trước khi thoái hóa tiến triển.
                  </p>
                </div>
              </article>

              <!-- KL3 -->
              <article
                class="glass-panel rounded-xl p-5 md:p-6 border border-white/10 flex flex-col md:flex-row gap-5"
              >
                <div class="flex-1">
                  <h3 class="text-lg md:text-xl font-semibold text-red-300">
                    KL3 — Trung bình
                  </h3>
                  <p class="mt-2 text-sm text-slate-300 leading-relaxed">
                    Giai đoạn KL3 được xác định khi khe khớp hẹp rõ, các gai
                    xương (osteophyte) lớn xuất hiện ở cả mặt trong và ngoài
                    khớp. Lớp sụn khớp bị mòn không đều, kèm xơ cứng dưới sụn rõ
                    rệt và đôi khi có thể xuất hiện các hốc xương nhỏ
                    (subchondral cysts). Trên lâm sàng, bệnh nhân cảm nhận cơn
                    đau thường xuyên hơn, đặc biệt khi vận động hoặc chịu lực.
                    Biên độ vận động khớp gối giảm, có thể nghe tiếng lạo xạo
                    hoặc cảm giác “kẹt khớp” khi di chuyển. Giai đoạn này đánh
                    dấu thoái hóa tiến triển trung bình và cần được can thiệp
                    điều trị tích cực.
                  </p>
                </div>
                <div class="w-full md:w-56 shrink-0">
                  <img
                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTKOEBZqf5ksljpCoUFWhxqFOWL9neuRS9LFD8_ZcMVLzTG9AyMjKL2BvmZjZMR381WNR0&usqp=CAU"
                    alt="KL3 trung bình"
                    class="w-full h-40 md:h-48 object-cover rounded-lg border border-white/10"
                  />
                </div>
              </article>

              <!-- KL4 -->
              <article
                class="glass-panel rounded-xl p-5 md:p-6 border border-white/10 flex flex-col md:flex-row gap-5"
              >
                <div class="w-full md:w-56 shrink-0">
                  <img
                    src="https://nhatnhat.com/pic/New/images/2018/xknn/5.jpg"
                    alt="KL4 nặng"
                    class="w-full h-40 md:h-48 object-cover rounded-lg border border-white/10"
                  />
                </div>
                <div class="flex-1">
                  <h3 class="text-lg md:text-xl font-semibold text-red-900">
                    KL4 — Nặng
                  </h3>
                  <p class="mt-2 text-sm text-slate-300 leading-relaxed">
                    Giai đoạn KL4 đặc trưng bởi sự hẹp khe khớp trầm trọng đến
                    mức gần như không còn khoảng gian khớp. Gai xương
                    (osteophyte) to, dày, xuất hiện ở cả hai bờ khớp; xơ cứng
                    dưới sụn nặng, kèm biến dạng đầu xương rõ rệt. Hình ảnh
                    X-quang thường cho thấy sự tiếp xúc trực tiếp giữa các mặt
                    xương, kèm các hốc xương (subchondral cysts) và biến dạng
                    trục chi. Bệnh nhân đau nhiều, hạn chế vận động nghiêm
                    trọng, khớp kêu lạo xạo mạnh hoặc gần như cố định. Điều trị
                    nội khoa ở giai đoạn này thường không còn hiệu quả, cần xem
                    xét phẫu thuật thay khớp hoặc can thiệp phục hồi chức năng
                    chuyên sâu.
                  </p>
                </div>
              </article>
            </div>
          </div>
        </div>
      </section>

      <!-- === VIEW: WORKSTATION (TOOL) === -->
      <section
        id="view-tool"
        class="hidden h-[calc(100vh-64px)] overflow-hidden flex flex-col md:flex-row"
      >
        <!-- Left Panel: Imaging Viewer -->
        <div class="w-full md:w-2/3 h-full bg-black relative flex flex-col p-4">
          <!-- Toolbar -->
          <div
            class="absolute top-4 left-4 right-4 z-10 flex justify-between items-start pointer-events-none"
          >
            <div
              class="glass-panel px-3 py-1 rounded text-xs font-mono text-medical-400 pointer-events-auto"
            >
              VIEWER_ID: KNEE_V2
            </div>
            <div class="flex space-x-2 pointer-events-auto">
              <button
                onclick="clearImage()"
                class="p-2 bg-slate-800 hover:bg-red-900/50 text-slate-300 rounded border border-white/10"
                title="Reset"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Main Drop Area -->
          <div
            id="drop-zone"
            class="flex-grow border-2 border-dashed border-slate-700 rounded-lg bg-slate-900/50 flex flex-col items-center justify-center relative overflow-hidden transition-all hover:border-medical-500/50 group"
          >
            <input
              type="file"
              id="file-input"
              class="hidden"
              accept="image/*"
              onchange="handleFileSelect(event)"
            />

            <!-- Empty State -->
            <div
              id="empty-state"
              class="text-center p-6 transition-opacity group-hover:opacity-100"
            >
              <div
                class="w-20 h-20 mx-auto mb-4 rounded-full bg-slate-800 flex items-center justify-center border border-slate-700 group-hover:border-medical-500 group-hover:bg-slate-800/80 transition-all"
              >
                <svg
                  class="w-10 h-10 text-slate-500 group-hover:text-medical-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                  ></path>
                </svg>
              </div>
              <h3 class="text-lg font-medium text-slate-300">
                Tải phim X-quang
              </h3>
              <p class="text-sm text-slate-500 mt-1">
                DICOM, PNG, JPG (Max 20MB)
              </p>
              <button
                onclick="triggerUpload()"
                class="mt-4 px-4 py-2 bg-medical-600/20 text-medical-400 border border-medical-600/50 rounded hover:bg-medical-600/30 text-sm font-mono"
              >
                BROWSE FILES
              </button>
            </div>

            <!-- Image Preview Container -->
            <div
              id="preview-container"
              class="hidden absolute inset-0 bg-black flex items-center justify-center scan-container"
            >
              <img
                id="image-preview"
                src="#"
                class="max-w-full max-h-full object-contain opacity-90"
                alt="Xray"
              />

              <!-- Grid Overlay -->
              <div
                class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImgridIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9InJnYmEoMjU1LDI1NSwyNTUsMC4wNSkiIHN0cm9rZS13aWR0aD0iMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIgLz48L3N2Zz4=')] pointer-events-none"
              ></div>

              <!-- Scanning Beam -->
              <div class="scan-beam"></div>

              <!-- ROI (Region of Interest) Box - Hidden initially -->
              <div
                id="roi-box"
                class="hidden absolute border-2 border-yellow-400 bg-yellow-400/10 box-content"
                style="
                  width: 150px;
                  height: 150px;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                "
              >
                <div
                  class="absolute -top-6 left-0 text-xs bg-yellow-400 text-black px-1 font-bold"
                >
                  DETECTED
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Stats inside Viewer -->
          <div
            class="mt-4 flex justify-between items-center text-[10px] text-slate-500 font-mono uppercase"
          >
            <div>System Status: <span class="text-green-500">ONLINE</span></div>
            <div><span id="res-model-view">Model: -</span></div>
          </div>
        </div>

        <!-- Right Panel: Report & Analysis -->
        <div
          class="w-full md:w-1/3 bg-slate-900 border-l border-white/5 flex flex-col"
        >
          <div class="p-6 border-b border-white/5">
            <h2 class="text-lg font-bold text-white flex items-center gap-2">
              <svg
                class="w-5 h-5 text-medical-400"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                />
              </svg>
              Phân tích AI
            </h2>
          </div>

          <!-- Analysis Content -->
          <div class="flex-grow p-6 overflow-y-auto">
            <!-- State: Waiting -->
            <div
              id="state-waiting"
              class="h-full flex flex-col items-center justify-center text-slate-600"
            >
              <div class="animate-pulse mb-4">
                <svg
                  class="w-12 h-12 opacity-20"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"
                  />
                </svg>
              </div>
              <p class="text-sm">Đang chờ hình ảnh...</p>
            </div>

            <!-- State: Analyzing -->
            <div
              id="state-loading"
              class="hidden h-full flex flex-col items-center justify-center"
            >
              <div class="relative w-20 h-20 mb-6">
                <div
                  class="absolute inset-0 border-4 border-slate-700 rounded-full"
                ></div>
                <div
                  class="absolute inset-0 border-4 border-t-medical-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"
                ></div>
                <div
                  class="absolute inset-0 flex items-center justify-center font-mono text-xs text-medical-400 animate-pulse"
                >
                  AI
                </div>
              </div>
              <p class="text-slate-300 font-mono text-sm">PROCESSING...</p>
              <div
                class="w-full max-w-[200px] bg-slate-800 h-1 mt-4 rounded-full overflow-hidden"
              >
                <div
                  class="h-full bg-medical-500 animate-[loading_2s_ease-in-out_infinite]"
                  style="width: 50%"
                ></div>
              </div>
              <div
                class="mt-4 space-y-1 text-xs text-slate-500 font-mono text-center"
              >
                <p>Pre-processing image...</p>
                <p>Extracting features...</p>
              </div>
            </div>

            <!-- State: Results -->
            <div id="state-result" class="hidden space-y-6">
              <!-- Primary Diagnosis -->
              <div
                class="bg-slate-800/50 rounded-lg p-4 border border-white/5 relative overflow-hidden"
              >
                <div class="absolute top-0 right-0 p-2 opacity-10">
                  <svg
                    class="w-24 h-24"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                    />
                  </svg>
                </div>
                <div class="text-xs text-slate-400 font-mono uppercase mb-1">
                  Dự đoán KL-Score
                </div>
                <div class="flex flex-wrap items-baseline gap-3">
                  <h3
                    id="res-grade"
                    class="text-4xl font-bold text-medical-400 tracking-tight"
                  >
                    Grade —
                  </h3>
                  <span
                    id="res-label"
                    class="text-slate-300 font-medium text-sm md:text-base"
                    >Chưa có kết quả</span
                  >
                </div>
              </div>

              <!-- Confidence Gauge -->
              <div>
                <div
                  class="flex justify-between text-[11px] md:text-xs text-slate-400 mb-2"
                >
                  <span>Độ tin cậy AI</span>
                  <span id="res-conf" class="text-white font-mono">—</span>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden mb-2">
                  <div
                    id="res-bar"
                    class="h-full bg-gradient-to-r from-medical-500 to-blue-500"
                    style="width: 0%"
                  ></div>
                </div>
                <div
                  class="flex justify-between text-[11px] md:text-xs text-slate-500"
                >
                  <span id="res-model">Mô hình: —</span>
                  <span id="res-latency">Thời gian suy luận: — ms</span>
                </div>
              </div>

              <!-- Technical Details -->
              <div class="space-y-3">
                <h4
                  class="text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-white/5 pb-2"
                >
                  Thông số phát hiện
                </h4>

                <div
                  class="flex items-center justify-between p-3 bg-slate-800/30 rounded border border-white/5"
                >
                  <span class="text-sm text-slate-300"
                    >Gai xương (Osteophytes)</span
                  >
                  <span
                    id="det-osteo"
                    class="text-xs font-mono py-1 px-2 rounded bg-red-500/10 text-red-900"
                    >DETECTED</span
                  >
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-slate-800/30 rounded border border-white/5"
                >
                  <span class="text-sm text-slate-300">Hẹp khe khớp (JSN)</span>
                  <span
                    id="det-jsn"
                    class="text-xs font-mono py-1 px-2 rounded bg-yellow-500/10 text-yellow-900"
                    >MILD</span
                  >
                </div>
                <div
                  class="flex items-center justify-between p-3 bg-slate-800/30 rounded border border-white/5"
                >
                  <span class="text-sm text-slate-300"
                    >Xơ xương (Sclerosis)</span
                  >
                  <span
                    id="det-scl"
                    class="text-xs font-mono py-1 px-2 rounded bg-green-500/10 text-green-900"
                    >NONE</span
                  >
                </div>
              </div>
              <!-- Recommendation -->
              <div
                class="bg-blue-900/20 border border-blue-500/20 p-4 rounded text-sm text-blue-900"
              >
                <strong class="block text-blue-400 text-xs uppercase mb-1"
                  >Khuyến nghị hệ thống:</strong
                >
                <div class="flex items-center gap-3 mb-2">
                  <p id="res-rec" class="flex-1">
                    Cần đối chiếu kết quả với lâm sàng và các xét nghiệm khác.
                    Khuyến nghị tham khảo ý kiến bác sĩ chuyên khoa để có kế
                    hoạch điều trị phù hợp.
                  </p>
                  <button
                    id="rec-toggle"
                    onclick="toggleRecDetails()"
                    class="px-3 py-1 text-xs font-semibold rounded bg-blue-500/20 text-blue-900 border border-blue-400/40 hover:bg-blue-500/30 disabled:opacity-50"
                    disabled
                  >
                    Chi tiết
                  </button>
                </div>
                <div
                  id="rec-details"
                  class="hidden whitespace-pre-line text-blue-900 bg-blue-500/5 border border-blue-500/20 rounded p-3 text-sm"
                ></div>
              </div>

              <!-- Biểu đồ xác suất KL -->
              <div class="space-y-2">
                <h4
                  class="text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-white/5 pb-2"
                >
                  Phân bố xác suất KL
                </h4>
                <div
                  class="bg-slate-900/60 border border-white/5 rounded-lg p-3"
                >
                  <canvas
                    id="probChart"
                    class="w-full h-40"
                    aria-label="Biểu đồ xác suất KL"
                  ></canvas>
                </div>
              </div>

              <div
                id="errorBox"
                class="mt-2 text-xs text-red-900 bg-red-500/10 border border-red-500/30 rounded px-3 py-2 hidden"
              ></div>
            </div>
          </div>

          <!-- Action Button -->
          <div class="p-6 border-t border-white/5 bg-slate-900">
            <button
              id="analyzeBtn"
              onclick="processImage()"
              disabled
              class="w-full py-3 bg-medical-600 hover:bg-medical-500 disabled:bg-slate-800 disabled:text-slate-600 text-white font-bold rounded flex items-center justify-center transition-all shadow-lg shadow-cyan-900/20"
            >
              CHẠY PHÂN TÍCH
            </button>
          </div>
        </div>
      </section>
    </main>
    <script
      src="{{ url_for('static', filename='js/sample.js') }}"
      defer
    ></script>
  </body>
</html>
